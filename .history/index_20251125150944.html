<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Tasheer DMI ‚Äì Assessment</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
        <link rel="stylesheet" href="styles_mediaP.css" />
        <link rel="stylesheet" href="login.css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body onload="initAssessmentPage()">
    <div id="pageLoader" class="d-flex flex-column justify-content-center align-items-center vh-100 bg-light" style="position: fixed; top: 0; left: 0; width: 100%; z-index: 1050;" aria-label="Loading">
        <img src="assets/img/company-logo.png" alt="Tasheer Logo" class="mb-3" />
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <div class="loaderText mt-3 text-primary">Loading Tasheer DMI Tool Digital Platform...</div>
    </div>

    <div class="container py-4">
        <header class="d-flex justify-content-between align-items-center border-bottom pb-3 mb-4">
            <div>
                <h1 id="assessmentTitle" class="mb-1" style="font-size: 1.3rem; color: #004d9c; font-weight: 600;">Digital Maturity Assessment</h1>
                <p id="assessmentSubTitle" class="lead text-muted mb-0"></p>
            </div>
            <div class="logo-container">
                <img src="assets/img/company-logo.png" alt="Tasheer" style="max-height: 100px;" />
            </div>
        </header>

        <div id="saveStatus" class="alert alert-success py-2" role="alert" style="display: none;">
            ‚úÖ Progress Saved Automatically!
        </div>

        <div class="row assessment-layout">
            <div class="col-lg-3 mb-4">
                <div class="card live-score-card shadow-sm">
                    <div class="card-body">
                        <h4 class="card-title mb-3">Live DMI Score</h4>
                        <div class="live-score-chart-container position-relative mb-3">
                            <canvas id="liveMaturityChart"></canvas>
                            <span class="score-percentage-center position-absolute top-50 start-50 translate-middle fs-3 fw-bold" id="liveScorePercentage">0%</span>
                        </div>
                        <div class="score-status text-center text-muted mb-3" id="liveScoreStatus">0 / 0 Questions Answered</div>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="openEvidenceFolder()">üìÇ Upload Evidence</button>
                            <button type="button" class="btn btn-sm btn-info" onclick="randomizeSelections()">üé≤ Random Answers</button>
                            <button type="button" class="btn btn-sm btn-danger" onclick="resetAllSelections()">‚ôªÔ∏è Reset All Selections</button>
                            <button type="button" class="btn btn-sm btn-warning" onclick="logout()">‚èª Logout</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-10 assessment-form-wrapper">
                <form id="assessmentForm">
                    <h2 class="mb-4">Please complete all questions below:</h2>
                    </form>
                <button type="button" class="btn btn-primary btn-lg w-100 mt-4" onclick="finalizeAssessment()">
                    Finalize Assessment & Generate Detailed Report
                    
                </button>
            </div>
        </div>
        
        <div id="reportSection" style="display:none;" class="mt-1">
            <div class="row report-grid g-4">
                <div class="col-md-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Overall Digital Maturity Score</h5>
                            <!-- <div class="score-display display-3 fw-bold text-primary mb-2" id="maturityScoreDisplay">0.00%</div> -->
                            <div class="score-metadata text-muted mb-4">
                                Based on an overall score of
                                <span id="totalScoreText" class="fw-bold">0</span> out of
                                <span id="maxScoreText" class="fw-bold">0</span> possible points.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="chart-wrapper card p-3 h-100 shadow-sm">
                        <canvas id="areaBarChart"></canvas>
                    </div>
                </div>
            </div>

<div id="maturityBandDisplay" class="mt-2 fw-bold text-primary" style="font-size: 1.1rem;"></div>
<div id="maturityBandDesc" class="text-muted mb-3" style="font-size: 0.9rem;"></div>


            <h5 class="mt-5 mb-3">Final Report Comments</h5>
            <div id="finalReportCommentsPrint" aria-hidden="true" class="d-none d-print-block"></div>
            <textarea id="finalReportComments" class="form-control" rows="5" placeholder="Enter your final comments on the assessment here. These comments will be included in the final PDF report."></textarea>

            <h5 class="mt-5 mb-3">Detailed Question Score Breakdown</h5>
            <div class="table-responsive">
                <table class="table table-striped table-bordered score-table">
                    <thead class="table-dark">
                        <tr>
                            <th style="width: 60px;">#</th>
                            <th>Question</th>
                            <th style="width: 60px; text-align: center;">Score</th>
                            <th style="width: 300px;">Selected Answer</th>
                            <th style="width: 300px;">Recommendations</th>
                        </tr>
                    </thead>
                    <tbody id="detailedScoreBody"></tbody>
                </table>
            </div>
            
            <div class="d-flex justify-content-end gap-3 mt-4">
              <button type="button" class="btn btn-success" onclick="copyCommentsToPrintMirror(); window.print()">üñ®Ô∏è Save as PDF</button>
                <button type="button" class="btn btn-primary" onclick="backToAssessment()"> ‚Üê Back to Assessment</button>
                 <button type="button" class="btn btn-primary" onclick="exportAllCommentsToCSV()"> ‚¨áÔ∏è Export Comments</button>
                 <button type="button" class="btn btn-primary" onclick="exportAllReportsToCSV()"> ‚¨áÔ∏è Export Report</button>
                                  <button type="button" class="btn btn-primary" onclick="exportAllReportsToExcel()">  üìä Export Department Report</button>

                <button type="button" class="btn btn-sm btn-warning" onclick="logout()">‚èª Logout</button>



            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx-style@0.8.13/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx-populate/browser/xlsx-populate.min.js"></script>

    
    <script src="maturitybands.js"></script>
    <script src="users.js"></script>
    <script src="logic.js"></script>


      <script src="assets/js/maturitybands.js"></script>
    <script src="assets/js/users.js"></script>
    <script src="assets/js/logic.js"></script>
    <script>
        window.hideLoader = function() {
            const el = document.getElementById('pageLoader');
            if (!el) return;
            // Using Bootstrap's 'd-none' and transition for fade out
            el.classList.add('d-none'); 
            // The original logic with a timeout for smoother transition is removed 
            // since we are using 'd-none' for immediate hiding, assuming custom CSS handles the 'fade-out' if desired.
        };
        // fallback: if something goes wrong, auto-hide after 4s so page remains usable
        setTimeout(() => window.hideLoader && window.hideLoader(), 4000);
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>